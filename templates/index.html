<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EPEVER Solar Controller</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #eee;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        
        header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 20px 0; border-bottom: 1px solid #333; margin-bottom: 30px;
        }
        header h1 { color: #00d4ff; font-size: 1.8em; }
        .status { display: flex; align-items: center; gap: 10px; }
        .status-dot { width: 12px; height: 12px; border-radius: 50%; }
        .status-dot.online { background: #00ff88; box-shadow: 0 0 10px #00ff88; }
        .status-dot.offline { background: #ff4444; box-shadow: 0 0 10px #ff4444; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        
        .card {
            background: rgba(255,255,255,0.05); border-radius: 15px; padding: 25px;
            border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(10px);
        }
        .card h2 { 
            color: #00d4ff; font-size: 1.1em; margin-bottom: 20px; 
            padding-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .stat-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .stat-row:last-child { border-bottom: none; }
        .stat-label { color: #888; }
        .stat-value { font-weight: 600; color: #fff; }
        
        .gauge-container { display: flex; flex-direction: column; align-items: center; padding: 15px; }
        .gauge {
            width: 120px; height: 120px; border-radius: 50%;
            background: conic-gradient(#00d4ff 0deg, #00d4ff var(--deg), #333 var(--deg), #333 360deg);
            display: flex; align-items: center; justify-content: center;
            position: relative;
        }
        .gauge-inner {
            width: 90px; height: 90px; border-radius: 50%; background: #1a1a2e;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .gauge-value { font-size: 1.5em; font-weight: bold; color: #fff; }
        .gauge-unit { font-size: 0.7em; color: #888; }
        .gauge-label { margin-top: 10px; color: #888; font-size: 0.9em; }
        
        .power-display { text-align: center; padding: 20px; }
        .power-value { font-size: 3em; font-weight: bold; color: #00d4ff; }
        .power-label { color: #888; margin-top: 5px; }
        
        .temp-display { display: flex; justify-content: space-around; padding: 15px 0; }
        .temp-item { text-align: center; }
        .temp-value { font-size: 2em; font-weight: bold; }
        .temp-value.hot { color: #ff6b6b; }
        .temp-value.normal { color: #00ff88; }
        .temp-value.cold { color: #4dabf7; }
        .temp-label { color: #888; font-size: 0.8em; margin-top: 5px; }
        
        .settings-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; }
        .setting-item {
            background: rgba(0,0,0,0.2); border-radius: 10px; padding: 15px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .setting-info { flex: 1; }
        .setting-name { font-weight: 500; margin-bottom: 3px; }
        .setting-desc { font-size: 0.75em; color: #666; }
        .setting-value { 
            background: rgba(0,0,0,0.3); border: 1px solid #333; border-radius: 8px;
            padding: 8px 12px; color: #00d4ff; min-width: 100px; text-align: right;
        }
        .setting-edit { margin-left: 10px; }
        .btn {
            background: #00d4ff; color: #000; border: none; border-radius: 8px;
            padding: 8px 15px; cursor: pointer; font-weight: 600; transition: all 0.2s;
        }
        .btn:hover { background: #00b8e6; transform: translateY(-1px); }
        .btn-sm { padding: 5px 10px; font-size: 0.8em; }
        .btn-danger { background: #ff4444; }
        .btn-danger:hover { background: #cc3333; }
        
        .update-time { text-align: center; color: #666; margin: 20px 0; }
        
        .nav-tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .nav-tab {
            background: rgba(255,255,255,0.05); border: none; border-radius: 10px;
            padding: 12px 25px; color: #888; cursor: pointer; transition: all 0.2s;
        }
        .nav-tab:hover { background: rgba(255,255,255,0.1); color: #fff; }
        .nav-tab.active { background: #00d4ff; color: #000; }
        
        .section { display: none; }
        .section.active { display: block; }
        
        .modal {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8); display: none; align-items: center;
            justify-content: center; z-index: 1000;
        }
        .modal.show { display: flex; }
        .modal-content {
            background: #1a1a2e; border-radius: 15px; padding: 30px;
            max-width: 400px; width: 90%; border: 1px solid #333;
        }
        .modal h3 { margin-bottom: 20px; color: #00d4ff; }
        .modal input, .modal select {
            width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #333;
            background: rgba(0,0,0,0.3); color: #fff; margin-bottom: 15px;
        }
        .modal-buttons { display: flex; gap: 10px; justify-content: flex-end; }
        
        .toast {
            position: fixed; bottom: 20px; right: 20px; padding: 15px 25px;
            border-radius: 10px; color: #fff; opacity: 0; transform: translateY(20px);
            transition: all 0.3s; z-index: 1001;
        }
        .toast.show { opacity: 1; transform: translateY(0); }
        .toast.success { background: #00ff88; color: #000; }
        .toast.error { background: #ff4444; }
        
        @media (max-width: 768px) {
            header h1 { font-size: 1.3em; }
            .grid { grid-template-columns: 1fr; }
            .power-value { font-size: 2em; }
        }
        
        .refresh-btn { position: fixed; bottom: 20px; left: 20px; z-index: 100; }
        .refresh-btn .btn { border-radius: 50%; width: 50px; height: 50px; padding: 0; font-size: 1.5em; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚òÄÔ∏è EPEVER Solar Controller</h1>
            <div class="status">
                <span class="status-dot" id="statusDot"></span>
                <span id="statusText">Verbinde...</span>
            </div>
        </header>

        <nav class="nav-tabs">
            <button class="nav-tab active" data-section="dashboard">Dashboard</button>
            <button class="nav-tab" data-section="battery">Batterie</button>
            <button class="nav-tab" data-section="statistics">Statistik</button>
            <button class="nav-tab" data-section="settings">Einstellungen</button>
        </nav>

        <!-- Dashboard -->
        <div id="dashboard" class="section active">
            <div class="grid">
                <div class="card">
                    <h2>‚ö° PV Solar</h2>
                    <div class="power-display">
                        <div class="power-value" id="pvPower">0</div>
                        <div class="power-label">Watt</div>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Spannung</span>
                        <span class="stat-value" id="pvVoltage">0 V</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Strom</span>
                        <span class="stat-value" id="pvCurrent">0 A</span>
                    </div>
                </div>

                <div class="card">
                    <h2>üîã Batterie</h2>
                    <div class="gauge-container">
                        <div class="gauge" id="socGauge" style="--deg: 0deg;">
                            <div class="gauge-inner">
                                <div class="gauge-value" id="batSoc">0</div>
                                <div class="gauge-unit">%</div>
                            </div>
                        </div>
                        <div class="gauge-label">State of Charge</div>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Spannung</span>
                        <span class="stat-value" id="batVoltage">0 V</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Ladestrom</span>
                        <span class="stat-value" id="chargeCurrent">0 A</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Ladeleistung</span>
                        <span class="stat-value" id="chargePower">0 W</span>
                    </div>
                </div>

                <div class="card">
                    <h2>üí° Last</h2>
                    <div class="power-display">
                        <div class="power-value" id="loadPower">0</div>
                        <div class="power-label">Watt</div>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Spannung</span>
                        <span class="stat-value" id="loadVoltage">0 V</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Strom</span>
                        <span class="stat-value" id="loadCurrent">0 A</span>
                    </div>
                </div>
            </div>

            <div class="grid">
                <div class="card">
                    <h2>üå°Ô∏è Temperaturen</h2>
                    <div class="temp-display">
                        <div class="temp-item">
                            <div class="temp-value" id="batTemp">--</div>
                            <div class="temp-label">Batterie</div>
                        </div>
                        <div class="temp-item">
                            <div class="temp-value" id="devTemp">--</div>
                            <div class="temp-label">Ger√§t</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>üìä Ladezustand</h2>
                    <div class="stat-row">
                        <span class="stat-label">Modus</span>
                        <span class="stat-value" id="chargingState">--</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Batterie SOH</span>
                        <span class="stat-value" id="batSoh">--</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Battery Section -->
        <div id="battery" class="section">
            <div class="card">
                <h2>üîã Batterie-Details</h2>
                <div class="stat-row">
                    <span class="stat-label">Typ</span>
                    <span class="stat-value" id="batType">--</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Kapazit√§t</span>
                    <span class="stat-value" id="batCapacity">--</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Min. Spannung heute</span>
                    <span class="stat-value" id="batMinToday">--</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Max. Spannung heute</span>
                    <span class="stat-value" id="batMaxToday">--</span>
                </div>
            </div>
        </div>

        <!-- Statistics Section -->
        <div id="statistics" class="section">
            <div class="grid">
                <div class="card">
                    <h2>‚òÄÔ∏è Heute</h2>
                    <div class="stat-row">
                        <span class="stat-label">Erzeugt</span>
                        <span class="stat-value" id="genToday">--</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Verbraucht</span>
                        <span class="stat-value" id="consToday">--</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Max PV-Spannung</span>
                        <span class="stat-value" id="pvMaxToday">--</span>
                    </div>
                </div>

                <div class="card">
                    <h2>üìÖ Gesamt</h2>
                    <div class="stat-row">
                        <span class="stat-label">Erzeugt</span>
                        <span class="stat-value" id="genTotal">--</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Verbraucht</span>
                        <span class="stat-value" id="consTotal">--</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">CO‚ÇÇ-Ersparnis</span>
                        <span class="stat-value" id="co2Saved">--</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Betriebsstunden</span>
                        <span class="stat-value" id="runHours">--</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Section -->
        <div id="settings" class="section">
            <div class="card">
                <h2>‚öôÔ∏è Batterie-Einstellungen</h2>
                <div class="settings-grid" id="batterySettings"></div>
            </div>
            
            <div class="card" style="margin-top: 20px;">
                <h2>üí° Last-Einstellungen</h2>
                <div class="settings-grid" id="loadSettings"></div>
            </div>
        </div>

        <div class="update-time">
            Letzte Aktualisierung: <span id="lastUpdate">--</span>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <h3 id="modalTitle">Einstellung √§ndern</h3>
            <input type="hidden" id="modalRegister">
            <input type="number" id="modalInput" step="0.01" placeholder="Neuer Wert">
            <select id="modalSelect" style="display:none;"></select>
            <div class="modal-buttons">
                <button class="btn" onclick="closeModal()">Abbrechen</button>
                <button class="btn btn-danger" onclick="saveSetting()">Speichern</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <!-- Refresh Button -->
    <div class="refresh-btn">
        <button class="btn" onclick="fetchData()" title="Aktualisieren">üîÑ</button>
    </div>

    <script>
        const SETTINGS_CONFIG = {
            'bat_type_raw': { reg: 0x9000, name: 'Batterietyp', unit: '', factor: 1, type: 'list', options: 'batteryTypes' },
            'bat_capacity': { reg: 0x9001, name: 'Kapazit√§t', unit: 'Ah', factor: 1, type: 'number' },
            'temp_comp': { reg: 0x9002, name: 'Temp-Kompensation', unit: 'mV/¬∞C/2V', factor: 1, type: 'number' },
            'high_volt_disconnect': { reg: 0x9003, name: '√úberspannung (HVD)', unit: 'V', factor: 0.01, type: 'number' },
            'charging_limit_volt': { reg: 0x9004, name: 'Ladelimit', unit: 'V', factor: 0.01, type: 'number' },
            'over_volt_reconnect': { reg: 0x9005, name: '√úberspannung Wiedereinschalt', unit: 'V', factor: 0.01, type: 'number' },
            'equalize_volt': { reg: 0x9006, name: 'Equalize Spannung', unit: 'V', factor: 0.01, type: 'number' },
            'boost_volt': { reg: 0x9007, name: 'Boost Spannung', unit: 'V', factor: 0.01, type: 'number' },
            'float_volt': { reg: 0x9008, name: 'Float Spannung', unit: 'V', factor: 0.01, type: 'number' },
            'low_volt_disconnect': { reg: 0x9009, name: 'Tiefentladung (LVD)', unit: 'V', factor: 0.01, type: 'number' },
            'under_volt_warning': { reg: 0x900A, name: 'Unterspannung Warnung', unit: 'V', factor: 0.01, type: 'number' },
            'low_volt_reconnect': { reg: 0x900B, name: 'Unterspannung Wiedereinschalt', unit: 'V', factor: 0.01, type: 'number' },
            'boost_reconnect_volt': { reg: 0x900C, name: 'Boost Wiedereinschalt', unit: 'V', factor: 0.01, type: 'number' },
            'boost_duration': { reg: 0x9013, name: 'Boost Dauer', unit: 'min', factor: 1, type: 'number' },
            'equalize_duration': { reg: 0x9014, name: 'Equalize Dauer', unit: 'min', factor: 1, type: 'number' },
            'load_mode_raw': { reg: 0x903D, name: 'Last-Modus', unit: '', factor: 1, type: 'list', options: 'loadModes' },
            'light_on_delay': { reg: 0x903E, name: 'Licht AN Verz√∂gerung', unit: 'min', factor: 1, type: 'number' },
            'light_off_delay': { reg: 0x903F, name: 'Licht AUS Verz√∂gerung', unit: 'min', factor: 1, type: 'number' },
            'load_timer1': { reg: 0x9042, name: 'Last Timer 1', unit: 'min', factor: 1, type: 'number' },
            'load_timer2': { reg: 0x904E, name: 'Last Timer 2', unit: 'min', factor: 1, type: 'number' },
        };

        let batteryTypes = {};
        let loadModes = {};
        const BASE_URL = window.location.pathname.replace(/\/$/, '');

        // Navigation
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(tab.dataset.section).classList.add('active');
            });
        });

        function setStatus(online) {
            const dot = document.getElementById('statusDot');
            const text = document.getElementById('statusText');
            if (online) {
                dot.className = 'status-dot online';
                text.textContent = 'Online';
            } else {
                dot.className = 'status-dot offline';
                text.textContent = 'Offline';
            }
        }

        function updateSocGauge(soc) {
            const deg = (soc / 100) * 360;
            document.getElementById('socGauge').style.setProperty('--deg', deg + 'deg');
        }

        function getTempClass(temp) {
            if (temp > 40) return 'hot';
            if (temp < 10) return 'cold';
            return 'normal';
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast ' + type + ' show';
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function openModal(key, currentValue) {
            const config = SETTINGS_CONFIG[key];
            if (!config) return;

            document.getElementById('modalTitle').textContent = config.name;
            document.getElementById('modalRegister').value = config.reg;

            const input = document.getElementById('modalInput');
            const select = document.getElementById('modalSelect');

            if (config.type === 'list') {
                input.style.display = 'none';
                select.style.display = 'block';
                select.innerHTML = '';
                
                const options = config.options === 'batteryTypes' ? batteryTypes : loadModes;
                for (const [val, name] of Object.entries(options)) {
                    const opt = document.createElement('option');
                    opt.value = val;
                    opt.textContent = name;
                    if (parseInt(val) === currentValue) opt.selected = true;
                    select.appendChild(opt);
                }
            } else {
                select.style.display = 'none';
                input.style.display = 'block';
                input.value = currentValue;
                input.step = config.factor < 1 ? '0.01' : '1';
            }

            document.getElementById('editModal').classList.add('show');
        }

        function closeModal() {
            document.getElementById('editModal').classList.remove('show');
        }

        async function saveSetting() {
            const reg = parseInt(document.getElementById('modalRegister').value);
            const config = Object.values(SETTINGS_CONFIG).find(c => c.reg === reg);
            
            let value;
            if (config.type === 'list') {
                value = parseInt(document.getElementById('modalSelect').value);
            } else {
                value = parseFloat(document.getElementById('modalInput').value);
                if (config.factor < 1) {
                    value = Math.round(value / config.factor);
                }
            }

            try {
                const response = await fetch(BASE_URL + '/api/settings/' + reg, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ value: value })
                });
                const data = await response.json();
                
                if (data.success) {
                    showToast('Einstellung gespeichert!');
                    closeModal();
                    fetchData();
                } else {
                    showToast('Fehler: ' + (data.error || 'Unbekannt'), 'error');
                }
            } catch (e) {
                showToast('Verbindungsfehler', 'error');
            }
        }

        function renderSettings(data) {
            const batteryContainer = document.getElementById('batterySettings');
            const loadContainer = document.getElementById('loadSettings');
            
            batteryContainer.innerHTML = '';
            loadContainer.innerHTML = '';

            const batteryKeys = ['bat_type_raw', 'bat_capacity', 'temp_comp', 'high_volt_disconnect', 
                'charging_limit_volt', 'over_volt_reconnect', 'equalize_volt', 'boost_volt', 
                'float_volt', 'low_volt_disconnect', 'under_volt_warning', 'low_volt_reconnect',
                'boost_reconnect_volt', 'boost_duration', 'equalize_duration'];
            
            const loadKeys = ['load_mode_raw', 'light_on_delay', 'light_off_delay', 'load_timer1', 'load_timer2'];

            for (const key of batteryKeys) {
                if (data[key] !== undefined) {
                    batteryContainer.appendChild(createSettingRow(key, data[key]));
                }
            }

            for (const key of loadKeys) {
                if (data[key] !== undefined) {
                    loadContainer.appendChild(createSettingRow(key, data[key]));
                }
            }
        }

        function createSettingRow(key, value) {
            const config = SETTINGS_CONFIG[key];
            const div = document.createElement('div');
            div.className = 'setting-item';
            
            let displayValue = value;
            if (config.type === 'list') {
                const options = config.options === 'batteryTypes' ? batteryTypes : loadModes;
                displayValue = options[value] || value;
            }

            div.innerHTML = `
                <div class="setting-info">
                    <div class="setting-name">${config.name}</div>
                    <div class="setting-desc">${config.unit}</div>
                </div>
                <div class="setting-value">${displayValue} ${config.type !== 'list' ? config.unit : ''}</div>
            `;
            return div;
        }

        async function fetchData() {
            try {
                // Load options first
                if (Object.keys(batteryTypes).length === 0) {
                    const [btRes, lmRes] = await Promise.all([
                        fetch(BASE_URL + '/api/battery-types'),
                        fetch(BASE_URL + '/api/load-modes')
                    ]);
                    batteryTypes = await btRes.json();
                    loadModes = await lmRes.json();
                }

                const response = await fetch(BASE_URL + '/api/data');
                const data = await response.json();
                
                if (data.error) {
                    setStatus(false);
                    return;
                }

                setStatus(true);

                // Realtime
                document.getElementById('pvPower').textContent = data.realtime.pv_power?.toFixed(0) || '0';
                document.getElementById('pvVoltage').textContent = data.realtime.pv_voltage?.toFixed(1) + ' V' || '--';
                document.getElementById('pvCurrent').textContent = data.realtime.pv_current?.toFixed(2) + ' A' || '--';
                
                document.getElementById('batSoc').textContent = data.realtime.bat_soc || '0';
                updateSocGauge(data.realtime.bat_soc || 0);
                document.getElementById('batVoltage').textContent = data.realtime.bat_voltage?.toFixed(1) + ' V' || '--';
                document.getElementById('chargeCurrent').textContent = data.realtime.charge_current?.toFixed(2) + ' A' || '--';
                document.getElementById('chargePower').textContent = data.realtime.charge_power?.toFixed(0) + ' W' || '--';
                
                document.getElementById('loadPower').textContent = data.realtime.load_power?.toFixed(0) || '0';
                document.getElementById('loadVoltage').textContent = data.realtime.load_voltage?.toFixed(1) + ' V' || '--';
                document.getElementById('loadCurrent').textContent = data.realtime.load_current?.toFixed(2) + ' A' || '--';

                const batTemp = data.realtime.bat_temp || 0;
                const devTemp = data.realtime.dev_temp || 0;
                document.getElementById('batTemp').textContent = batTemp.toFixed(1) + '¬∞C';
                document.getElementById('batTemp').className = 'temp-value ' + getTempClass(batTemp);
                document.getElementById('devTemp').textContent = devTemp.toFixed(1) + '¬∞C';
                document.getElementById('devTemp').className = 'temp-value ' + getTempClass(devTemp);

                document.getElementById('chargingState').textContent = data.realtime.charging_state || '--';
                document.getElementById('batSoh').textContent = data.realtime.bat_soh + '%' || '--';

                // Battery section
                document.getElementById('batType').textContent = data.settings.bat_type || '--';
                document.getElementById('batCapacity').textContent = data.settings.bat_capacity + ' Ah' || '--';
                document.getElementById('batMinToday').textContent = data.statistics.bat_min_today?.toFixed(2) + ' V' || '--';
                document.getElementById('batMaxToday').textContent = data.statistics.bat_max_today?.toFixed(2) + ' V' || '--';

                // Statistics
                document.getElementById('genToday').textContent = data.statistics.generation_today?.toFixed(2) + ' kWh' || '--';
                document.getElementById('consToday').textContent = data.statistics.consumption_today?.toFixed(2) + ' kWh' || '--';
                document.getElementById('pvMaxToday').textContent = data.statistics.pv_max_today?.toFixed(1) + ' V' || '--';
                
                document.getElementById('genTotal').textContent = data.statistics.generation_total?.toFixed(1) + ' kWh' || '--';
                document.getElementById('consTotal').textContent = data.statistics.consumption_total?.toFixed(1) + ' kWh' || '--';
                document.getElementById('co2Saved').textContent = data.statistics.co2_saved?.toFixed(1) + ' kg' || '--';
                document.getElementById('runHours').textContent = data.statistics.running_hours + ' h' || '--';

                // Settings
                renderSettings(data.settings);

                document.getElementById('lastUpdate').textContent = data.last_update;

            } catch (e) {
                console.error('Fetch error:', e);
                setStatus(false);
            }
        }

        // Initial load
        fetchData();
        
        // Auto-refresh every 10 seconds
        setInterval(fetchData, 10000);
    </script>
</body>
</html>
